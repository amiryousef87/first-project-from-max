<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Max Management Dashboard</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <!-- Simple DataTables (for table functionality) -->
    <link
      href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome Icons -->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>

    <style>
      /* Custom Font */
      body {
        font-family: "Inter", system-ui, sans-serif;
      }

      /* Define a custom color scheme */
      :root {
        --primary-color: #5a67d8; /* Indigo */
        --secondary-color: #48bb78; /* Green */
        --bg-dark: #1f2937; /* Dark Gray */
        --bg-light: #f9fafb; /* Off White */
      }

      /* Custom styles for the fixed layout/menu system (L-T-R Adjustments) */
      .sb-nav-fixed #layoutSidenav {
        display: flex;
      }

      #layoutSidenav_nav {
        flex-basis: 225px;
        flex-shrink: 0;
        transition: margin-left 0.15s ease-in-out; /* Adjusted for LTR */
      }

      #layoutSidenav_content {
        flex-grow: 1;
        overflow-x: hidden;
        background-color: var(--bg-light);
      }

      /* Hide sidebar on mobile by default (LTR adjustment: Pushes left) */
      .sb-nav-fixed #layoutSidenav #layoutSidenav_nav {
        margin-left: -225px;
        margin-right: 0;
      }

      /* Show sidebar when active class is present (LTR adjustment: Moves into view) */
      .sb-sidenav-toggled #layoutSidenav #layoutSidenav_nav {
        margin-left: 0;
      }

      @media (min-width: 992px) {
        /* Desktop view - Default state: Sidebar visible */
        .sb-nav-fixed #layoutSidenav #layoutSidenav_nav {
          margin-left: 0;
        }
        /* Desktop view - Toggled state: Sidebar hidden */
        .sb-sidenav-toggled #layoutSidenav #layoutSidenav_nav {
          margin-left: -225px;
        }
      }

      /* Ensures the sidebar is fixed (LTR adjustment) */
      .sb-sidenav {
        position: fixed;
        top: 56px; /* Below the top nav */
        bottom: 0;
        left: 0; /* Align left for LTR */
        right: auto;
        width: 225px;
        overflow-y: auto;
        background-color: var(--bg-dark);
        z-index: 1020;
      }

      /* Adjust main content padding when sidebar is visible on desktop (LTR adjustment) */
      @media (min-width: 992px) {
        .sb-nav-fixed #layoutSidenav #layoutSidenav_content {
          padding-left: 225px;
          padding-right: 0;
        }
        .sb-sidenav-toggled #layoutSidenav #layoutSidenav_content {
          padding-left: 0;
        }
      }

      /* Ensure card body content is centered and visible */
      .card-body-content {
        font-size: 2.5rem;
        font-weight: 700;
      }
    </style>

    <script>
      // Function to toggle the sidebar
      function toggleSidebar() {
        document.body.classList.toggle("sb-sidenav-toggled");
      }

      // Initialize Simple DataTables and Charts on window load
      window.onload = function () {
        // 1. Sidebar Toggle Setup
        document
          .getElementById("sidebarToggle")
          .addEventListener("click", toggleSidebar);

        // 2. Initialize DataTables
        try {
          const datatablesSimple = document.getElementById("datatablesSimple");
          if (datatablesSimple) {
            // Removed custom Persian labels to use default English/browser settings
            new simpleDatatables.DataTable(datatablesSimple);
          }
        } catch (e) {
          console.error("Simple DataTables failed to initialize:", e);
        }

        // 3. Initialize Charts with Fake Data (Simulating SQLite fetch)

        // --- FAKE DATA GENERATION ---
        const activityData = {
          labels: [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
          ],
          datasets: [
            {
              label: "Activity Scores",
              lineTension: 0.3,
              backgroundColor: "rgba(90, 103, 216, 0.2)",
              borderColor: "var(--primary-color)",
              pointRadius: 5,
              pointBackgroundColor: "var(--primary-color)",
              pointBorderColor: "rgba(255,255,255,0.8)",
              pointHoverRadius: 5,
              pointHoverBackgroundColor: "var(--primary-color)",
              pointHitRadius: 50,
              pointBorderWidth: 2,
              data: [
                10000, 15000, 25000, 30000, 28000, 35000, 42000, 38000, 45000,
                50000,
              ],
            },
          ],
        };

        const missionData = {
          labels: ["Completed", "In Progress", "Overdue", "Deferred"],
          datasets: [
            {
              label: "Mission Status",
              backgroundColor: ["#48BB78", "#F6E05E", "#E53E3E", "#718096"],
              data: [45, 20, 10, 5],
            },
          ],
        };
        // -----------------------------

        // --- Activity Chart (Area/Line) ---
        const activityCtx = document.getElementById("activityChart");
        if (activityCtx) {
          new Chart(activityCtx, {
            type: "line",
            data: activityData,
            options: {
              maintainAspectRatio: false,
              legend: { display: false },
              scales: {
                xAxes: [
                  {
                    time: { unit: "month" },
                    gridLines: { display: false, drawBorder: false },
                    ticks: { maxTicksLimit: 7 },
                  },
                ],
                yAxes: [
                  {
                    ticks: {
                      min: 0,
                      max: 50000,
                      maxTicksLimit: 5,
                      padding: 10,
                      callback: (value) => value.toLocaleString() + " Points",
                    },
                    gridLines: { color: "rgba(0, 0, 0, .125)" },
                  },
                ],
              },
              tooltips: {
                callbacks: {
                  label: (tooltipItem, chart) =>
                    chart.datasets[0].label +
                    ": " +
                    tooltipItem.yLabel.toLocaleString() +
                    " Points",
                },
              },
            },
          });
        }

        // --- Missions Bar Chart ---
        const barCtx = document.getElementById("myBarChart");
        if (barCtx) {
          new Chart(barCtx, {
            type: "bar",
            data: missionData,
            options: {
              maintainAspectRatio: false,
              legend: { display: false },
              scales: {
                xAxes: [{ gridLines: { display: false } }],
                yAxes: [
                  {
                    ticks: { min: 0, max: 60, maxTicksLimit: 5 },
                    gridLines: { display: true },
                  },
                ],
              },
            },
          });
        }
      };
    </script>
  </head>

  <body class="sb-nav-fixed">
    <!-- Top Navbar -->
    <nav class="bg-gray-800 text-white shadow-lg fixed top-0 w-full z-30">
      <div
        class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-14"
      >
        <div class="flex items-center">
          <a
            class="text-xl font-semibold tracking-wider hover:text-indigo-400 transition"
            href="#"
            >Max Dashboard</a
          >

          <!-- Sidebar Toggle Button -->
          <button
            class="ml-3 p-2 rounded-lg hover:bg-gray-700 transition lg:hidden"
            id="sidebarToggle"
          >
            <i class="fas fa-bars text-lg"></i>
          </button>
        </div>

        <!-- Right side: User Menu (LTR) -->
        <div class="ml-auto">
          <div class="relative group">
            <a
              class="flex items-center p-2 rounded-full hover:bg-gray-700 transition cursor-pointer"
              id="userMenu"
            >
              <!-- User Avatar (Using Jinja logic) -->
              {% if user and user.avatar %}
              <img
                src="{{ url_for('static', filename='uploads/avatars/' ~ user.avatar) }}"
                alt="avatar"
                class="rounded-full w-8 h-8 object-cover border-2 border-white/20"
              />
              {% else %}
              <div
                class="rounded-full bg-indigo-500 text-white flex items-center justify-center w-8 h-8 text-sm border-2 border-white/20"
              >
                <i class="fas fa-user"></i>
              </div>
              {% endif %}

              <!-- NOTE: Fixed Jinja error here -->
              <span class="ml-2 hidden sm:inline text-sm font-medium"
                >{{ user.username if user else 'Account' }}</span
              >
              <i class="fas fa-angle-down ml-2 text-xs"></i>
            </a>

            <!-- Dropdown Menu -->
            <ul
              class="absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-lg shadow-2xl overflow-hidden hidden group-hover:block transition duration-200 z-50"
            >
              <li>
                <a
                  class="block px-4 py-2 text-sm hover:bg-gray-100 transition"
                  href="{{ url_for('profile') }}"
                  ><i class="fas fa-user-circle mr-2"></i>Profile</a
                >
              </li>
              <li>
                <hr class="border-gray-100" />
              </li>
              <li>
                <a
                  class="block px-4 py-2 text-sm hover:bg-gray-100 transition text-red-500"
                  href="{{ url_for('logout') }}"
                  ><i class="fas fa-sign-out-alt mr-2"></i>Logout</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div id="layoutSidenav" class="pt-14 flex">
      <!-- Sidebar (LTR) -->
      <div id="layoutSidenav_nav" class="sb-sidenav bg-gray-900">
        <nav class="sb-sidenav-menu text-white flex flex-col h-full">
          <div class="p-4 flex-grow">
            <div
              class="text-xs uppercase tracking-wider font-semibold text-gray-400 mb-3"
            >
              My Dashboard
            </div>

            <!-- User Profile in Sidebar (Jinja Logic) -->
            {% if user %}
            <div class="px-3 mb-6">
              <div class="flex items-center gap-3 bg-gray-800 p-3 rounded-lg">
                {% if user.avatar %}
                <img
                  src="{{ url_for('static', filename='uploads/avatars/' ~ user.avatar) }}"
                  class="rounded-full w-10 h-10 object-cover border-2 border-indigo-400"
                />
                {% else %}
                <div
                  class="rounded-full bg-white text-gray-800 flex items-center justify-center w-10 h-10"
                >
                  <i class="fas fa-user"></i>
                </div>
                {% endif %}
                <div>
                  <div class="font-bold text-sm">{{ user.username }}</div>
                  <div class="text-xs text-gray-400">
                    {{ user.family_name or 'User' }}
                  </div>
                </div>
              </div>
            </div>
            {% endif %}

            <!-- Nav Links -->
            <a
              class="nav-link flex items-center p-3 rounded-lg transition hover:bg-indigo-600 hover:text-white"
              href="{{ url_for('projects_dashboard') }}"
            >
              <div class="w-6 text-left"><i class="fas fa-tasks mr-3"></i></div>
              My Projects
            </a>
            <a
              class="nav-link flex items-center p-3 rounded-lg transition hover:bg-indigo-600 hover:text-white"
              href="{{ url_for('videos') }}"
            >
              <div class="w-6 text-left"><i class="fas fa-video mr-3"></i></div>
              Videos
            </a>
            <a
              class="nav-link flex items-center p-3 rounded-lg transition hover:bg-indigo-600 hover:text-white"
              href="{{ url_for('certificates') }}"
            >
              <div class="w-6 text-left">
                <i class="fas fa-certificate mr-3"></i>
              </div>
              My Certificates
            </a>
            <a
              class="nav-link flex items-center p-3 rounded-lg transition hover:bg-indigo-600 hover:text-white"
              href="{{ url_for('courses') }}"
            >
              <div class="w-6 text-left">
                <i class="fas fa-graduation-cap mr-3"></i>
              </div>
              My Courses
            </a>
            <a
              class="nav-link flex items-center p-3 rounded-lg transition hover:bg-indigo-600 hover:text-white"
              href="{{ url_for('charts') }}"
            >
              <div class="w-6 text-left">
                <i class="fas fa-chart-line mr-3"></i>
              </div>
              Progress Charts
            </a>
          </div>
        </nav>
      </div>

      <!-- Main Content -->
      <div id="layoutSidenav_content" class="min-h-screen">
        <main>
          <div class="container-fluid px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h1>
            <nav class="text-sm font-medium text-gray-500 mb-6">
              <ol class="flex space-x-2">
                <li class="breadcrumb-item active text-indigo-600">Overview</li>
              </ol>
            </nav>

            <!-- Cards -->
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
            >
              <!-- Card 1: Tasks Overview -->
              <div
                class="bg-indigo-600 text-white rounded-xl shadow-xl transition duration-300 hover:shadow-2xl hover:scale-[1.01] overflow-hidden"
              >
                <div class="p-5">
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="text-sm opacity-90">Tasks Completed</div>
                      <div class="card-body-content">87</div>
                    </div>
                    <i class="fas fa-tasks text-4xl opacity-50"></i>
                  </div>
                </div>
                <a
                  class="bg-black/20 block text-center py-2 text-xs font-semibold hover:bg-black/30 transition"
                  href="{{ url_for('tasks') }}"
                >
                  View Details <i class="fas fa-angle-right ml-1"></i>
                </a>
              </div>

              <!-- Card 2: Today's Videos -->
              <div
                class="bg-yellow-500 text-white rounded-xl shadow-xl transition duration-300 hover:shadow-2xl hover:scale-[1.01] overflow-hidden"
              >
                <div class="p-5">
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="text-sm opacity-90">Today's Videos</div>
                      <div class="card-body-content">3</div>
                    </div>
                    <i class="fas fa-video text-4xl opacity-50"></i>
                  </div>
                </div>
                <a
                  class="bg-black/20 block text-center py-2 text-xs font-semibold hover:bg-black/30 transition"
                  href="{{ url_for('videos') }}"
                >
                  View Details <i class="fas fa-angle-right ml-1"></i>
                </a>
              </div>

              <!-- Card 3: Certificates Earned -->
              <div
                class="bg-green-600 text-white rounded-xl shadow-xl transition duration-300 hover:shadow-2xl hover:scale-[1.01] overflow-hidden"
              >
                <div class="p-5">
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="text-sm opacity-90">Certificates Earned</div>
                      <div class="card-body-content">12</div>
                    </div>
                    <i class="fas fa-certificate text-4xl opacity-50"></i>
                  </div>
                </div>
                <a
                  class="bg-black/20 block text-center py-2 text-xs font-semibold hover:bg-black/30 transition"
                  href="{{ url_for('certificates') }}"
                >
                  View Details <i class="fas fa-angle-right ml-1"></i>
                </a>
              </div>

              <!-- Card 4: Courses Completed -->
              <div
                class="bg-red-600 text-white rounded-xl shadow-xl transition duration-300 hover:shadow-2xl hover:scale-[1.01] overflow-hidden"
              >
                <div class="p-5">
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="text-sm opacity-90">Courses Completed</div>
                      <div class="card-body-content">4</div>
                    </div>
                    <i class="fas fa-graduation-cap text-4xl opacity-50"></i>
                  </div>
                </div>
                <a
                  class="bg-black/20 block text-center py-2 text-xs font-semibold hover:bg-black/30 transition"
                  href="{{ url_for('courses') }}"
                >
                  View Details <i class="fas fa-angle-right ml-1"></i>
                </a>
              </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              <!-- Chart 1: Activity Chart -->
              <div class="bg-white rounded-xl shadow-xl p-5">
                <div
                  class="text-lg font-semibold text-gray-800 border-b pb-3 mb-4"
                >
                  <i class="fas fa-chart-area mr-2 text-indigo-600"></i> Monthly
                  Activity Scores
                </div>
                <div class="h-80">
                  <canvas id="activityChart"></canvas>
                </div>
              </div>

              <!-- Chart 2: Missions Bar Chart -->
              <div class="bg-white rounded-xl shadow-xl p-5">
                <div
                  class="text-lg font-semibold text-gray-800 border-b pb-3 mb-4"
                >
                  <i class="fas fa-chart-bar mr-2 text-green-600"></i> Today's
                  Mission Status
                </div>
                <div class="h-80">
                  <canvas id="myBarChart"></canvas>
                </div>
              </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl shadow-xl p-5">
              <div
                class="text-lg font-semibold text-gray-800 border-b pb-3 mb-4"
              >
                <i class="fas fa-table mr-2 text-red-600"></i> Active Team
                Members
              </div>
              <div class="overflow-x-auto">
                <table
                  id="datatablesSimple"
                  class="w-full text-left text-gray-700"
                >
                  <thead>
                    <tr
                      class="uppercase text-xs font-medium text-gray-500 bg-gray-50"
                    >
                      <th class="py-3 px-4">Name</th>
                      <th class="py-3 px-4">Position</th>
                      <th class="py-3 px-4">Office</th>
                      <th class="py-3 px-4">Age</th>
                      <th class="py-3 px-4">Start Date</th>
                      <th class="py-3 px-4">Salary</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-b hover:bg-gray-50 transition">
                      <td class="py-3 px-4">Shahrzad Daker</td>
                      <td class="py-3 px-4">Regional Director</td>
                      <td class="py-3 px-4">Edinburgh</td>
                      <td class="py-3 px-4">51</td>
                      <td class="py-3 px-4">2008/11/13</td>
                      <td class="py-3 px-4">$183,000</td>
                    </tr>
                    <tr class="border-b hover:bg-gray-50 transition">
                      <td class="py-3 px-4">Michael Bruce</td>
                      <td class="py-3 px-4">JavaScript Developer</td>
                      <td class="py-3 px-4">Singapore</td>
                      <td class="py-3 px-4">29</td>
                      <td class="py-3 px-4">2011/06/27</td>
                      <td class="py-3 px-4">$183,000</td>
                    </tr>
                    <tr class="border-b hover:bg-gray-50 transition">
                      <td class="py-3 px-4">Donna Snyder</td>
                      <td class="py-3 px-4">Customer Support</td>
                      <td class="py-3 px-4">New York</td>
                      <td class="py-3 px-4">27</td>
                      <td class="py-3 px-4">2011/01/25</td>
                      <td class="py-3 px-4">$112,000</td>
                    </tr>
                    <!-- Additional Mock Data -->
                    <tr class="border-b hover:bg-gray-50 transition">
                      <td class="py-3 px-4">Olivia Mason</td>
                      <td class="py-3 px-4">Project Manager</td>
                      <td class="py-3 px-4">London</td>
                      <td class="py-3 px-4">34</td>
                      <td class="py-3 px-4">2019/04/01</td>
                      <td class="py-3 px-4">$98,000</td>
                    </tr>
                    <tr class="border-b hover:bg-gray-50 transition">
                      <td class="py-3 px-4">Elias Kim</td>
                      <td class="py-3 px-4">UX Designer</td>
                      <td class="py-3 px-4">Seoul</td>
                      <td class="py-3 px-4">25</td>
                      <td class="py-3 px-4">2022/07/15</td>
                      <td class="py-3 px-4">$76,000</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </main>

        <!-- Footer -->
        <footer class="py-4 bg-white mt-auto border-t border-gray-200">
          <div class="container-fluid px-4">
            <div
              class="flex flex-col md:flex-row items-center justify-between small text-gray-500 text-center md:text-left"
            >
              <p>&copy; 2024 Designed and Developed by Max Corp</p>
              <div class="flex space-x-4 mt-2 md:mt-0">
                <a href="#" class="hover:text-indigo-600">Privacy Policy</a>
                <a href="#" class="hover:text-indigo-600">Terms & Conditions</a>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Scripts are loaded in the head/body bottom for better performance -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      async
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"></script>
  </body>
</html>
