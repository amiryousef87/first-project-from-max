<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تنظیمات حساب کاربری</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      /* تنظیمات RTL و فونت فارسی */
      :root {
        --sidebar-width: 16rem; /* 256px */
      }
      .sidebar {
        width: var(--sidebar-width);
      }
      .sidebar a .material-icons-outlined,
      .sidebar a .fa {
        margin-left: 0.75rem; /* ml-3 در RTL */
      }
      .dropdown-menu {
        right: 0;
        left: auto; /* اطمینان از راست‌چین بودن منوی کشویی */
      }
      body {
        font-family: Tahoma, "B Titr", "B Nazanin", Arial, sans-serif;
        background-color: #f7f9fb; /* رنگ زمینه روشن‌تر */
      }
      /* استایل دهی به Checkbox/Toggle برای زیبایی بیشتر */
      input[type="checkbox"] {
        /* جایگزین Tailwind class */
        @apply appearance-none h-6 w-11 bg-gray-300 rounded-full relative cursor-pointer transition-colors duration-300;
      }
      input[type="checkbox"]:checked {
        @apply bg-emerald-500;
      }
      input[type="checkbox"]::after {
        content: "";
        @apply absolute top-0.5 right-0.5 h-5 w-5 bg-white rounded-full shadow transition-transform duration-300;
        transform: translateX(0);
      }
      input[type="checkbox"]:checked::after {
        transform: translateX(
          -18px
        ); /* 11px (w-11) - 6px (h-6) = 5px.  11-5=6. -18px is approx right for RTL */
        /* برای RTL، بعد از چک شدن باید به سمت چپ (از دید مرورگر) حرکت کند */
      }
    </style>
  </head>
  <body>
    <div class="flex h-screen overflow-hidden">
      <aside
        class="sidebar bg-indigo-700 text-white flex-shrink-0 flex flex-col shadow-xl"
      >
        <div class="p-6 font-extrabold text-3xl border-b border-indigo-600">
          <a href="{{ url_for('admin') }}" class="flex items-center text-white">
            Admin <span class="text-indigo-300">Max</span>
          </a>
        </div>
        <nav class="mt-4 flex-1 overflow-y-auto">
          <a
            href="{{ url_for('admin') }}"
            class="flex items-center px-6 py-3 hover:bg-indigo-600 transition-colors duration-200"
          >
            <span class="material-icons-outlined">dashboard</span>
            داشبورد
          </a>
          <a
            href="{{ url_for('users') }}"
            class="flex items-center px-6 py-3 hover:bg-indigo-600 transition-colors duration-200"
          >
            <span class="material-icons-outlined">people_alt</span> کاربران
          </a>
          <a
            href="{{ url_for('setting') }}"
            class="flex items-center px-6 py-3 bg-indigo-800 border-r-4 border-emerald-400 font-semibold transition-all duration-200"
          >
            <span class="material-icons-outlined">settings</span> تنظیمات
          </a>

          <a
            href="{{ url_for('add_product') }}"
            class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-all duration-200 gap-2"
          >
            <span class="material-icons-outlined"> shopping_cart </span>
            سبد خرید
          </a>
        </nav>
        <div class="p-4 border-t border-indigo-600">
          <a
            href="{{ url_for('logout') }}"
            class="flex items-center px-6 py-3 text-red-300 hover:bg-indigo-600 hover:text-red-100 transition-colors duration-200 rounded-lg"
          >
            <span class="material-icons-outlined">logout</span> خروج
          </a>
        </div>
      </aside>

      <main class="flex-1 overflow-y-auto p-6 md:p-10">
        <div
          class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200"
        >
          <h1 class="text-3xl font-bold text-gray-800 flex items-center">
            <span
              class="material-icons-outlined text-4xl ml-2 text-emerald-500 align-middle"
            >
              tune
            </span>
            مدیریت تنظیمات حساب کاربری
          </h1>

          <div class="flex items-center space-x-4 space-x-reverse">
            <a
              href="{{ url_for('index') }}"
              class="flex items-center px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors shadow-md text-sm"
            >
              <span class="material-icons-outlined ml-2">open_in_new</span>
              مشاهده سایت
            </a>

            <div class="relative group" id="userMenuContainer"></div>
          </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <div
            class="bg-white shadow-2xl rounded-xl p-8 border-t-4 border-indigo-500"
          >
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
              <span class="material-icons-outlined ml-2 text-indigo-500"
                >account_circle</span
              >
              اطلاعات شخصی
            </h2>
            <form>
              <div class="flex items-center mb-6 space-x-4 space-x-reverse">
                {% if current_user.avatar %}
                <img
                  src="{{ url_for('static', filename='uploads/avatars/' ~ current_user.avatar) }}"
                  alt="avatar"
                  class="w-20 h-20 rounded-full object-cover border-4 border-gray-200 shadow"
                />
                {% else %}
                <div
                  class="w-20 h-20 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-3xl border-4 border-gray-200 shadow"
                >
                  {{ current_user.username[0]|upper }}
                </div>
                {% endif %}
                <label
                  class="block text-gray-600 cursor-pointer hover:text-indigo-600 transition"
                >
                  <span class="material-icons-outlined align-middle ml-1"
                    >upload_file</span
                  >
                  تغییر تصویر آواتار
                  <input type="file" class="hidden" />
                </label>
              </div>

              <div class="mb-5">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >نام کاربری</label
                >
                <input
                  type="text"
                  value="{{ current_user.username }}"
                  class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 bg-gray-50"
                />
              </div>
              <div class="mb-5">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >ایمیل</label
                >
                <input
                  type="email"
                  value="{{ current_user.email }}"
                  class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 bg-gray-50"
                  disabled
                  title="ایمیل توسط ادمین قابل تغییر نیست."
                />
              </div>

              <button
                type="submit"
                class="mt-4 w-full bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold shadow-md shadow-indigo-200 flex items-center justify-center"
              >
                <span class="material-icons-outlined ml-2">save</span>
                ذخیره تغییرات
              </button>
            </form>
          </div>

          <div
            class="bg-white shadow-2xl rounded-xl p-8 border-t-4 border-yellow-500"
          >
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
              <span class="material-icons-outlined ml-2 text-yellow-500"
                >security</span
              >
              مدیریت نشست‌ها
            </h2>

            <p class="text-gray-600 mb-4">
              نشست‌های فعال شما در دستگاه‌های مختلف:
            </p>

            <ul class="space-y-3">
              {% for s in sessions %}
              <li
                class="flex justify-between items-center p-3 border rounded-xl {% if s.is_current %}bg-yellow-50{% else %}bg-gray-50{% endif %}"
              >
                <span class="flex items-center text-gray-800">
                  <span
                    class="material-icons-outlined text-xl ml-2 {% if s.is_current %}text-yellow-600{% else %}text-gray-500{% endif %}"
                  >
                    {{ 'computer' if 'win' in s.device|lower or 'mac' in
                    s.device|lower else 'smartphone' }}
                  </span>
                  {{ s.device }} / {{ s.browser }}
                  <span class="text-xs text-gray-500 mr-2"
                    >({{ s.last_active.strftime('%Y-%m-%d %H:%M') }})</span
                  >
                </span>

                {% if s.is_current %}
                <span class="text-xs text-yellow-700 font-semibold"
                  >نشست فعال</span
                >
                {% else %}
                <form
                  action="{{ url_for('logout_session', session_id=s.id) }}"
                  method="POST"
                >
                  <button
                    class="text-red-500 hover:text-red-700 transition-colors text-sm font-semibold flex items-center"
                  >
                    <span class="material-icons-outlined text-base align-middle"
                      >logout</span
                    >
                    خروج
                  </button>
                </form>
                {% endif %}
              </li>
              {% else %}
              <li class="text-gray-500 text-sm">هیچ نشست فعالی یافت نشد.</li>
              {% endfor %}
            </ul>

            <form action="{{ url_for('logout_all_sessions') }}" method="POST">
              <button
                type="submit"
                class="mt-6 w-full text-red-600 bg-red-100 px-4 py-3 rounded-lg hover:bg-red-200 transition-colors font-semibold flex items-center justify-center border border-red-300"
              >
                <span class="material-icons-outlined ml-2">clear_all</span>
                خروج از همه دستگاه‌ها
              </button>
            </form>
          </div>
        </div>
      </main>
    </div>

    <script>
      // اسکریپت منوی کشویی کاربر (که در این صفحه حذف شد)
    </script>
  </body>
</html>
